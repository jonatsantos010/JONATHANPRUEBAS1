<div class="panel-info-cotizador">
  <panel-widget title="COTIZADOR">

    <panel-table [items]="[{}]" [headerTemplate]="headerTemplateGeneral" [bodyTemplate]="bodyTemplateGeneral">
    </panel-table>

    <ng-template #headerTemplateGeneral>
      <!--    <th class="text-center width-140">Total asegurado</th> -->
      <th class="text-center width-140">Prima</th>
      <th></th>
    </ng-template>

    <ng-template #bodyTemplateGeneral let-item="item">
      <td class="text-center">
        <span>{{trama?.PRIMA || '0' | prettyNumber:2}}</span>
      </td>
      <td class="text-center">
        <div *ngIf="detail">
          <form-button
            *ngIf="(detail && cotizador?.calculado) || (!cotizacion.primaflag && !cotizador?.calculado && cotizacion.modoVista == CONSTANTS.MODO_VISTA.EVALUAR)"
            label="Ver coberturas" (click)="clickProponer()" btnClass="btn-primary"></form-button>
          <!--<form-button *ngIf="detail && !cotizador?.calculado" label="Calcular" (click)="clickCalcularSinTrama()" btnClass="btn-primary"></form-button> -->
          <form-button
            *ngIf="cotizacion.modoVista == CONSTANTS.MODO_VISTA.EVALUAR && !cotizador?.calculado && cotizacion.primaflag && cotizacion.poliza.dps.estado== 'PROCESO EXITOSO'"
            label="Calcular" (click)="clickCalcularPrimaDPS()" btnClass="btn-primary"></form-button>
          <!-- && !detail && cotizador?.recalculo-->
        </div>
      </td>
    </ng-template>

    <div class="row margin-bottom-15">
      <div class="col-md-6">
      </div>
      <div class="col-md-6 text-right"
        *ngIf="cotizacion.modoVista != CONSTANTS.MODO_VISTA.EVALUAR && detail && (trama?.validado || cotizador?.calculado || cotizacion.modoTrama) && !cotizacion.calcularCober">
        <!--<form-button *ngIf="!cotizador?.calculado" label="Calcular" (click)="clickCalcularSinTrama()" btnClass="btn-primary"></form-button>-->
        <form-button label="Ver coberturas" (click)="clickProponer()" btnClass="btn-primary coberturas-cal">
        </form-button>
      </div>
    </div>

    <!-- Tabla de cotizacion -->
    <div class="row" *ngIf="detail && cotizador?.calculado">
      <div
        [ngClass]="{'col-md-6' : cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 6, 'col-md-6' :  cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA != 6}">
        <div class="table-responsive">
          <table class="table table-hover" style="border: 1px solid #ececec;">
            <thead>
              <tr style="color: #212529; background-color: rgba(0,0,0,.075);">
                <th>Tipo de plan</th>
                <th>&nbsp;</th>
                <th *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 5"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 5 ? 'borderSidesHeader text-center' : 'text-center'">
                  Mensual</th>
                <th *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 4"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 4 ? 'borderSidesHeader text-center' : 'text-center'">
                  Bimestral</th>
                <th *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 3"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 3 ? 'borderSidesHeader text-center' : 'text-center'">
                  Trimestral</th>
                <th *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 2"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 2 ? 'borderSidesHeader text-center' : 'text-center'">
                  Semestral</th>
                <th *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 1"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 1 ? 'borderSidesHeader text-center' : 'text-center'">
                  Anual</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of trama?.amountPremiumList; let index = index;">
                <td>{{item.SCATEGORIA}}</td>
                <td>{{item.DES_TASA}}</td>
                <td *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 5"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 5 ? 'borderSides text-center' : 'text-center'">
                  {{item.NPREMIUMN_MEN | prettyNumber:2}}</td>
                <td *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 4"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 4 ? 'borderSides text-center' : 'text-center'">
                  {{item.NPREMIUMN_BIM | prettyNumber:2}}</td>
                <td *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 3"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 3 ? 'borderSides text-center' : 'text-center'">
                  {{item.NPREMIUMN_TRI | prettyNumber:2}}</td>
                <td *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 2"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 2 ? 'borderSides text-center' : 'text-center'">
                  {{item.NPREMIUMN_SEM | prettyNumber:2}}</td>
                <td *ngIf="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 1"
                  [className]="cotizacion.poliza.frecuenciaPago.COD_TIPO_FRECUENCIA == 1 ? 'borderSides text-center' : 'text-center'">
                  {{item.NPREMIUMN_ANU | prettyNumber:2}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="row margin-bottom-15"
      *ngIf="cotizacion.modoVista != CONSTANTS.MODO_VISTA.EVALUAR && detail && (trama?.validado || cotizador?.calculado || cotizacion.modoTrama) && !cotizacion.calcularCober">
      <div class="col-sm-4" [ngClass]="{'col-sm-6' : cotizacion.modoVista == CONSTANTS.MODO_VISTA.EXCLUIR}">
        <div class="table-responsive">
          <table class="table table-hover" style="border: 1px solid #ececec;">
            <thead>
              <tr style="color: #212529; background-color: rgba(0,0,0,.075);">
                <th>S.A.</th>
                <th style="text-align: right;" *ngIf="cotizacion.modoVista !== CONSTANTS.MODO_VISTA.EXCLUIR">Prima
                  {{cotizacion?.poliza?.frecuenciaPago?.DES_TIPO_FRECUENCIA}}</th>
                <th style="text-align: right;" *ngIf="cotizacion.modoVista == CONSTANTS.MODO_VISTA.EXCLUIR">MONTO A
                  DEVOLVER</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cotizador.amountPremiumListAnu; let last = last" [class.font-bold]="last">
                <td>{{item.DES_TASA || (item.CAPITAL | prettyNumber:2)}}</td>
                <td class="text-right">{{item.NPREMIUMN_ANU | prettyNumber:2}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-sm-4"
        *ngIf="cotizacion.modoTrama != true && CONSTANTS.MODO_VISTA.POLIZARENOVAR !== cotizacion.modoVista && cotizacion.modoVista !== CONSTANTS.MODO_VISTA.EXCLUIR  && cotizacion.modoVista !== CONSTANTS.MODO_VISTA.POLIZAINCLUIR">
        <div class="table-responsive">
          <table class="table table-hover" style="border: 1px solid #ececec;">
            <thead>
              <tr style="color: #212529; background-color: rgba(0,0,0,.075);">
                <th>S.A propuesta</th>
                <th style="text-align: right;">Prima prop.</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cotizador.amountPremiumListProp; let last = last" [class.font-bold]="last">
                <td>{{item.DES_TASA || (item.CAPITAL | prettyNumber:2)}}</td>
                <td class="text-right">{{item.NPREMIUMN_ANU | prettyNumber:2}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-sm-4"
        *ngIf="cotizacion.modoTrama != true && CONSTANTS.MODO_VISTA.POLIZARENOVAR !== cotizacion.modoVista && cotizacion.modoVista !== CONSTANTS.MODO_VISTA.EXCLUIR  && cotizacion.modoVista !== CONSTANTS.MODO_VISTA.POLIZAINCLUIR">
        <div class="table-responsive">
          <table class="table table-hover" style="border: 1px solid #ececec;">
            <thead>
              <tr style="color: #212529; background-color: rgba(0,0,0,.075);">
                <th>S.A Autorizada</th>
                <th style="text-align: right;">Prima aut.</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cotizador.amountPremiumListAut; let last = last" [class.font-bold]="last">
                <td>{{item.DES_TASA || (item.CAPITAL | prettyNumber:2)}}</td>
                <td class="text-right">{{item.NPREMIUMN_ANU | prettyNumber:2}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="row"
      *ngIf="cotizacion.modoVista != CONSTANTS.MODO_VISTA.EVALUAR && cotizacion.modoTrama != true && CONSTANTS.MODO_VISTA.POLIZARENOVAR !== cotizacion.modoVista && cotizacion.modoVista !== CONSTANTS.MODO_VISTA.EXCLUIR && cotizacion.modoVista !== CONSTANTS.MODO_VISTA.POLIZAINCLUIR">
      <div class="col-sm-6" *ngIf="!!detail">
        <h5 style="font-size: 14px;">ARCHIVO ADJUNTOS </h5>
        <table class="table table-borderless riesgo tblbroker">
          <thead>
            <tr class="d-flex">
              <th class="col-sm text-center"><label>Nombre del archivo</label>
              </th>
              <th class="col-sm text-center"><label>Descargar</label></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let filePath of cotizador.files" class="d-flex">
              <td class="col-sm text-center">
                <span>{{ filePath | fileName }}</span>
              </td>
              <td class="col-sm text-center"><a (click)="downloadFile(filePath)"><img src="assets/icons/imprimir.png"
                    title="Descargar" style="cursor:pointer;" alt="Descargar" /></a>
              </td>
            </tr>
          </tbody>
          <tbody *ngIf="!cotizador?.files?.length">
            <tr class="d-flex">
              <td colspan="2" class="col-sm text-center"><span>No se encontraron archivos</span></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col-sm-{{detail ? 6 : 12}}">
        <form-input-textarea label="Comentario" [(value)]="cotizador.comentario" [disabled]="detail"
          [patternPrevent]="CONSTANTS.REGEX.LEGALNAME"></form-input-textarea>
      </div>
    </div>

    <div class="row" *ngIf="cotizacion.activarFormaPago">
      <div class="col-md-12">
        <b style="text-transform: uppercase">Pago adelantado</b>
      </div>
      <div class="col-sm-3 margin-top-10">
        <form-input-checkbox [items]="[
            { codigo: 'PAGO_ADEL',
              valor: 'Pago Adelantado',
              disabled: !!cotizacion.modoVista ? cotizacion.modoVista == 'Evaluar': false,
              isSelected: !!cotizacion.modoVista ? cotizacion.modoVista == 'Evaluar': false
            }
          ]" [disabled]="false" [(mapSelected)]="cotizador.checkbox"></form-input-checkbox>
      </div>
    </div>

    <div class="row" *ngIf="cotizacion.modoVista != CONSTANTS.MODO_VISTA.EVALUAR && !detail">
      <div class="col-sm-12">
        <form-input-file label="Documentos de los asegurados" [multiple]="true" [(value)]="cotizador.files">
        </form-input-file>
      </div>
    </div>

    <!-- MODAL COBERTURAS-->
    <panel-modal title="Información de coberturas" [(open)]="show.coberturas" btnConfirmLabel="Cerrar"
      [templateBody]="templateCoberturas"></panel-modal>

    <ng-template #templateCoberturas>
      <div class="container">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': tabCoberturas === true}" data-toggle="tab"
              (click)="showTabs('1');">COBERTURAS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': tabAsistencias === true}" data-toggle="tab"
              (click)="showTabs('2');">ASISTENCIAS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': tabBeneficios === true}" data-toggle="tab"
              (click)="showTabs('3');">BENEFICIOS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': tabRecargos === true}" data-toggle="tab"
              (click)="showTabs('4');">RECARGOS</a>
          </li>
        </ul>
        <div id="myTabContent" class="tab-content">
          <div class="tab-pane fade" [ngClass]="{'show active': tabCoberturas === true}" *ngIf="tabCoberturas === true">
            <div class="container mt-3">
              <panel-table [(items)]="coberturas" [(reload)]="cargaCobertura" [datosBase]="coberturas" [pagination]="true"
                [service]="accPersonalesService" method="getTiposCoberturas" [params]="{
          segmentoId: poliza.tipoPlan.ID_PLAN,
          planId: poliza.tipoPlan.ID_PLAN,
          IdProc: trama.NIDPROC,
          codBranch: CONSTANTS.RAMO,
          channel:
              cotizacion.brokers.length > 0
                ? cotizacion.brokers[0].COD_CANAL
                : null,
          policyType: CONSTANTS.TIPO_POLIZA.INDIVIDUAL,
          renewalType: poliza.renovacion.codigo,
          billingType: poliza.tipoFacturacion.codigo,
          creditType: poliza.tipoPerfil.COD_PRODUCT,
          tipoProducto: 1,
          codPerfil: poliza.tipoPerfil?.COD_PRODUCT,
          monedaId: poliza.moneda?.NCODIGINT,
          tipoTransac: cotizacion.transac,
          tipoModalidad: poliza.modalidad?.ID,
          ciiuId: '',
          tipoEmpleado: '1',
          fechaEfecto: fechaActual
        }" [headerTemplate]="headerTemplateGeneral" [bodyTemplate]="bodyTemplateCoberturas">
              </panel-table>

              <ng-template #headerTemplateGeneral>
                <th class="text-center"> Sel.</th>
                <th class="">Código</th>
                <th class="">Coberturas</th>
                <th class="">S.A.</th>
                <th *ngIf="CONSTANTS.PERFIL.EXTERNO !== storageService.user?.profileId" class="text-center width-140">
                  <span> {{ verificarTextSA() }} </span>
                </th>
              </ng-template>

              <ng-template #bodyTemplateCoberturas let-item="item">
                <td class="text-center">
                  <form-input-checkbox [items]="[
                  { codigo: 'checked',
                    valor: '',
                    disabled: verificarFlag(item, 1),
                    isSelected: item.cobertura_adi == 1 ? true : false
                  }
                ]" (change)="clickCalcularPrima($event.target, 'coberturas', item.codCobertura);">
                  </form-input-checkbox>
                </td>
                <td class="text-center">{{item.ncover}}</td>
                <td class="">{{item.descripcion}}
                  <span class="message-validation">{{item.message}}</span>
                </td>
                <td class="">{{item.capital}}</td>
                <td *ngIf="CONSTANTS.PERFIL.EXTERNO !== storageService.user?.profileId
         && cotizacion.modoVista != CONSTANTS.MODO_VISTA.POLIZAINCLUIR" class="text-center padding-top-0 padding-bottom-0">
                  <form-input-text (change)="clickCalcularPrima();" [(value)]="item.capital_prop"
                    [disabled]="verificarInputSA(item)" [onlyInput]="true" [patternPrevent]="CONSTANTS.REGEX.DECIMAL"
                    placeholder="0" maxCaracter="6"></form-input-text>
                </td>
              </ng-template>

            </div>
          </div>
          <div class="tab-pane fade" [ngClass]="{'show active': tabAsistencias === true}" *ngIf="tabAsistencias === true">
            <div class="container mt-3">
              <panel-table [(items)]="asistencias" [(reload)]="cargaAsistencia" [datosBase]="asistencias" [pagination]="true"
                [service]="accPersonalesService" fieldItems="ListAssists" method="getAssits" [params]="{
                  codProduct: poliza.producto?.codigo,
                  segmentoId: poliza.tipoPlan.ID_PLAN,
                  planId: poliza.tipoPlan.ID_PLAN,
                  IdProc: trama.NIDPROC,
                  codBranch: CONSTANTS.RAMO,
                  channel:
                    cotizacion.brokers.length > 0
                    ? cotizacion.brokers[0].COD_CANAL
                    : null,
                  policyType: CONSTANTS.TIPO_POLIZA.INDIVIDUAL,
                  renewalType: poliza.renovacion.codigo,
                  billingType: poliza.tipoFacturacion.codigo,
                  creditType: poliza.tipoPerfil.COD_PRODUCT,
                  tipoProducto: 1,
                  codPerfil: poliza.tipoPerfil?.COD_PRODUCT,
                  monedaId: poliza.moneda?.NCODIGINT,
                  tipoTransac: cotizacion.transac,
                  tipoModalidad: poliza.modalidad?.ID,
                  ciiuId: '',
                  tipoEmpleado: '1',
                  fechaEfecto: fechaActual
                }" [headerTemplate]="headerTemplateGeneral" [bodyTemplate]="bodyTemplateAsistencias">
              </panel-table>

              <ng-template #headerTemplateGeneral>
                <th class="text-center"> Sel.</th>
                <th class="">Código</th>
                <th class="">Asistencias</th>

              </ng-template>

              <ng-template #bodyTemplateAsistencias let-item="item">
                <td class="text-center">

                  <form-input-checkbox [items]="[
                      { codigo: 'checked',
                        valor: '',
                        disabled: verificarFlag(item, 2),
                        isSelected: item.sMark == '1' ? true : false
                      }
                    ]" (change)="clickCalcularPrima($event.target, 'asistencias', item.codAssist);">
                  </form-input-checkbox>

                </td>
                <td class="">{{item.codAssist}}</td>
                <td class="">{{item.desAssist}}</td>
              </ng-template>
            </div>
          </div>
          <div class="tab-pane fade" [ngClass]="{'show active': tabBeneficios === true}" *ngIf="tabBeneficios === true">
            <div class="container mt-3">
              <panel-table [(items)]="beneficios" [(reload)]="cargaBeneficios" [datosBase]="beneficios" [pagination]="true"
                [service]="accPersonalesService" fieldItems="ListBenefits" method="getBenefits" [params]="{
                codBranch: CONSTANTS.RAMO,
                channel:
                    cotizacion.brokers.length > 0
                    ? cotizacion.brokers[0].COD_CANAL
                    : null,
                codProduct: poliza.producto?.codigo,
                codPerfil: poliza.tipoPerfil?.COD_PRODUCT,
                IdProc: trama.NIDPROC,
                tipoProducto: 1,
                monedaId: poliza.moneda?.NCODIGINT,
                segmentoId: poliza.codSegmento,
                planId: poliza.tipoPlan.ID_PLAN,
                currency: poliza.moneda?.NCODIGINT,
                renewalType: poliza.renovacion.codigo,
                billingType: poliza.tipoFacturacion.codigo,
                creditType: poliza.tipoPerfil.COD_PRODUCT,
                policyType: CONSTANTS.TIPO_POLIZA.INDIVIDUAL,
                tipoModalidad: poliza.modalidad?.ID
              }" [headerTemplate]="headerTemplateGeneral" [bodyTemplate]="bodyTemplateBenefits">
              </panel-table>

              <ng-template #headerTemplateGeneral>
                <th class="text-center"> Sel.</th>
                <th class="">Código</th>
                <th class="">Beneficios</th>
              </ng-template>
              <ng-template #bodyTemplateBenefits let-item="item">
                <td class="text-center">

                  <form-input-checkbox [items]="[
                    { codigo: 'checked',
                      valor: '',
                      disabled: verificarFlag(item, 3),
                      isSelected: item.sMark == '1' ? true : false
                    }
                  ]" (change)="clickCalcularPrima($event.target, 'beneficios', item.codBenefit);">
                  </form-input-checkbox>
                </td>
                <td class="">{{item.codBenefit}}</td>
                <td class="">{{item.desBenefit}}</td>
              </ng-template>
            </div>
          </div>

          <div class="tab-pane fade" [ngClass]="{'show active': tabRecargos === true}" *ngIf="tabRecargos === true">
            <div class="container mt-3">
              <panel-table [(items)]="recargos" [reload]="true" [datosBase]="recargos" [pagination]="true"
                [service]="accPersonalesService" fieldItems="ListSurcharges" method="getSurcharges" [params]="{
                codProduct: poliza.producto?.codigo,
                segmentoId: poliza.codSegmento,
                planId: poliza.tipoPlan?.ID_PLAN,
                IdProc: trama.NIDPROC,
                codBranch: CONSTANTS.RAMO,
                channel: cotizacion.brokers.length > 0 ? cotizacion.brokers[0].COD_CANAL : null,
                policyType: CONSTANTS.TIPO_POLIZA.INDIVIDUAL,
                renewalType: poliza.renovacion.codigo,
                billingType: poliza.tipoFacturacion.codigo,
                creditType: poliza.tipoPerfil.COD_PRODUCT,
                tipoProducto: 1,
                codPerfil: poliza.tipoPerfil?.COD_PRODUCT,
                monedaId: poliza.moneda?.NCODIGINT,
                tipoTransac: cotizacion.transac,
                tipoModalidad: poliza.modalidad?.ID,
                ciiuId: '',
                tipoEmpleado: '1',
                fechaEfecto: fechaActual                                
              }" [headerTemplate]="headerTemplateGeneral" [bodyTemplate]="bodyTemplateSurcharges">
              </panel-table>

              <ng-template #headerTemplateGeneral>
                <th class="text-center"> Sel.</th>
                <th class="">Código</th>
                <th class="">Recargos</th>
                <th class="text-center">Monto</th>
              </ng-template>
              <ng-template #bodyTemplateSurcharges let-item="item">
                <td class="text-center">

                  <form-input-checkbox [items]="[
                    { codigo: 'checked',
                      valor: '',
                      disabled: verificarFlag(item, 5),
                      isSelected: item.sMark == '1' ? true : false
                    }
                  ]" (change)="clickCalcularPrima($event.target, 'recargos', item.codSurcharge);">
                  </form-input-checkbox>
                </td>
                <td class="">{{item.order}}</td>
                <td class="">{{item.desSurcharge}}</td>
                <td class="text-center">{{item.value}} %</td>
              </ng-template>
            </div>
          </div>

        </div>
        <div class="col-md-4 float-right">
          <form-input-text label="prima neta" [value]="primaNeta | prettyNumber:2" [disabled]="true" [onlyInput]="true"
            [patternPrevent]="CONSTANTS.REGEX.DECIMAL" placeholder="0"></form-input-text>
        </div>
      </div>
    </ng-template>

  </panel-widget>
</div>